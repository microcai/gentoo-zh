From 71e2d33146dd4fd017065be1e6445d4bad8c3671 Mon Sep 17 00:00:00 2001
From: Keeyou <keeyou-cn@outlook.com>
Date: Sun, 7 Apr 2024 17:09:55 +0800
Subject: [PATCH] loongarch64: blacklist gtk4

---
 CMakeLists.txt | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 68e536b0..a4e4a58e 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -2055,8 +2055,17 @@ elseif (GUI)
       set(GUI off)
     endif()
 
+    # fix up for loongarch gtk support
+    # see https://github.com/microcai/gentoo-zh/pull/4486
+    if (CMAKE_SYSTEM_PROCESSOR STREQUAL "loongarch64")
+      message(STATUS "Blacklist gtk4 for loongarch64 target")
+      set(BLACKLIST_GTK4 ON)
+    else()
+      set(BLACKLIST_GTK4 OFF)
+    endif()
+
     pkg_check_modules(GTK4 gtk4)
-    if (GTK4_FOUND)
+    if (GTK4_FOUND AND NOT BLACKLIST_GTK4)
       set(GUI_FLAVOUR "gtk4")
       set(GUI_OTHER_FLAGS -Wno-deprecated-declarations)
 
-- 
2.44.0

